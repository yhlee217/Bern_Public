# 1.2.12. 프롬프트 엔지니어링

> **작성자**: Bern
> **작성일**: 2025-10-25
> **카테고리**: LLM / 프롬프트

---

## 목차
1. [프롬프트 엔지니어링의 정의](#1-프롬프트-엔지니어링의-정의)
2. [핵심 개념](#2-핵심-개념)
3. [하이퍼파라미터](#3-하이퍼파라미터)
4. [유형별 프롬프트 예시](#4-유형별-프롬프트-예시)
5. [실전 노하우](#5-실전-노하우)

---

## 1. 프롬프트 엔지니어링의 정의

### 1.1. 프롬프트 엔지니어링이란?

**프롬프트 엔지니어링(Prompt Engineering)**은 LLM으로부터 원하는 결과를 얻기 위해 입력(프롬프트)을 최적화하는 기술입니다.

```
일반 질문: "스마트팜이 뭐야?"
→ 짧고 일반적인 답변

엔지니어링된 질문: "당신은 20년 경력의 스마트팜 전문가입니다.
초보 농업인을 위해 스마트팜의 개념, 핵심 기술 3가지, 도입 효과를
구체적인 예시와 함께 설명해주세요."
→ 구체적이고 전문적인 답변
```

### 1.2. 왜 중요한가?

- **성능 향상**: 같은 모델로 더 좋은 결과
- **비용 절감**: 재시도 감소, 토큰 효율↑
- **일관성**: 안정적인 출력 품질
- **제어**: 원하는 형식, 톤 조절

---

## 2. 핵심 개념

### 2.1. 명확한 지시어

**Before (모호한 지시)**:
```python
prompt = "스마트팜에 대해 알려줘"
```

**After (명확한 지시)**:
```python
prompt = """
다음 조건에 맞춰 스마트팜을 설명하세요:
1. 대상: 농업 입문자
2. 길이: 3-5문장
3. 포함 내용: 정의, 주요 기술, 도입 효과
4. 형식: 불릿 포인트
"""
```

### 2.2. Few-shot Learning

**Zero-shot (예시 없음)**:
```python
prompt = "다음 문장의 감정을 분류하세요: '스마트팜 도입 후 수확량이 늘었어요!'"
```

**Few-shot (예시 포함)**:
```python
prompt = """
다음은 감정 분류 예시입니다:

입력: "농사가 너무 힘들어요"
출력: 부정

입력: "올해 수확이 대풍이에요!"
출력: 긍정

이제 다음 문장을 분류하세요:
입력: "스마트팜 도입 후 수확량이 늘었어요!"
출력:
"""
```

**코드 예시**:
```python
from openai import OpenAI

client = OpenAI(api_key="YOUR_API_KEY")

# Few-shot 프롬프트
few_shot_prompt = """
다음은 농업 용어를 초보자에게 설명하는 예시입니다:

Q: 양액이 뭔가요?
A: 양액은 식물 생장에 필요한 영양소를 물에 녹인 액체 비료입니다.
   스마트팜에서는 자동으로 적정량을 공급합니다.

Q: 광합성이 뭔가요?
A: 광합성은 식물이 빛 에너지를 이용해 이산화탄소와 물로
   양분을 만드는 과정입니다. 스마트팜은 LED로 최적의 빛을 제공합니다.

이제 다음 질문에 같은 방식으로 답변하세요:

Q: 환경 제어가 뭔가요?
A:
"""

response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": few_shot_prompt}],
    temperature=0.7
)

print(response.choices[0].message.content)
```

**실행 결과**:
```
환경 제어는 온도, 습도, CO2 농도 등 작물 생육 환경을 인공적으로 조절하는
것입니다. 스마트팜에서는 센서와 자동화 장비로 최적의 환경을 유지합니다.
```

### 2.3. Chain-of-Thought (CoT)

**Without CoT (직접 답변)**:
```python
prompt = "10평 온실에 토마토를 심으려면 몇 그루가 필요한가요?"
```

**With CoT (단계적 사고)**:
```python
prompt = """
다음 문제를 단계별로 풀이하세요:

문제: 10평 온실에 토마토를 심으려면 몇 그루가 필요한가요?

단계:
1. 10평을 제곱미터로 환산
2. 토마토 1그루당 필요한 면적 확인
3. 계산

풀이:
"""
```

**실행 결과**:
```
풀이:
1. 10평을 제곱미터로 환산
   - 1평 = 3.3㎡
   - 10평 = 10 × 3.3 = 33㎡

2. 토마토 1그루당 필요한 면적 확인
   - 일반적으로 토마토 1그루는 0.5~0.7㎡ 필요
   - 평균 0.6㎡로 계산

3. 계산
   - 33㎡ ÷ 0.6㎡ = 55그루

답: 약 50-55그루의 토마토를 심을 수 있습니다.
```

### 2.4. Zero-shot Prompting

모델에게 예시 없이 작업 수행:

```python
prompt = """
당신은 데이터 분류 전문가입니다.
다음 농업 문서를 적절한 카테고리로 분류하세요.

카테고리: 기술, 정책, 사례연구, 시장동향

문서: "정부는 2024년 스마트팜 보급을 위해 500억원 예산을 편성했다."

카테고리:
"""
```

### 2.5. Instruction Tuning

명령어 형식으로 작업 지시:

```python
instruction_prompt = """
[명령]
다음 농업 뉴스를 3줄로 요약하세요.

[규칙]
- 핵심 정보 위주
- 숫자는 정확히 표기
- 객관적 톤 유지

[입력]
농촌진흥청은 스마트팜 기술을 활용한 토마토 재배 시 생산성이
일반 재배 대비 30% 향상되었다고 발표했다. 특히 환경 제어 시스템을
도입한 농가는 노동 시간이 50% 감소하고 에너지 비용도 20% 절감됐다.

[출력]
"""
```

### 2.6. System Prompting (역할 부여)

```python
from openai import OpenAI

client = OpenAI(api_key="YOUR_API_KEY")

response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[
        {
            "role": "system",
            "content": """당신은 20년 경력의 스마트팜 컨설턴트입니다.
            초보 농업인에게 친절하고 구체적으로 설명하며,
            항상 실제 사례를 포함합니다."""
        },
        {
            "role": "user",
            "content": "스마트팜 도입 시 초기 비용을 줄이는 방법은?"
        }
    ]
)

print(response.choices[0].message.content)
```

---

## 3. 하이퍼파라미터

### 3.1. temperature

**정의**: 출력의 무작위성/창의성 조절 (0~2)

```python
# temperature = 0 (결정적, 일관성 높음)
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "스마트팜의 장점 3가지"}],
    temperature=0  # 매번 같은 답변
)

# temperature = 0.7 (균형)
# 일반적으로 사용

# temperature = 1.5 (창의적, 다양성 높음)
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "스마트팜 이름 제안"}],
    temperature=1.5  # 창의적인 제안
)
```

| 값 | 특징 | 사용 사례 |
|----|------|----------|
| **0** | 결정적, 일관성 최대 | 정확한 답변, 분류, 추출 |
| **0.3-0.5** | 약간의 변화 | 문서 요약, 번역 |
| **0.7-0.9** | 균형 (기본값) | 일반 대화, Q&A |
| **1.0-2.0** | 창의적, 다양성 | 브레인스토밍, 스토리 생성 |

### 3.2. top_p (Nucleus Sampling)

**정의**: 확률 분포 상위 p% 토큰만 샘플링 (0~1)

```python
# top_p = 0.1 (보수적, 안전한 선택)
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "안전한 농약 사용법"}],
    top_p=0.1  # 확률 높은 토큰만
)

# top_p = 0.9 (일반적)
# temperature와 함께 사용 시 하나만 조절 권장
```

### 3.3. max_tokens

**정의**: 생성할 최대 토큰 수

```python
# 짧은 답변
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "스마트팜이 뭔가요?"}],
    max_tokens=50  # 간단한 답변
)

# 긴 답변
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "스마트팜 전체 가이드 작성"}],
    max_tokens=2000  # 상세한 답변
)
```

**토큰 예상**:
- 한국어: 1 단어 ≈ 2-3 토큰
- 영어: 1 단어 ≈ 1.3 토큰

### 3.4. frequency_penalty

**정의**: 반복 억제 (-2.0 ~ 2.0)

```python
# frequency_penalty = 0 (반복 허용)
# 기본값, 반복 제한 없음

# frequency_penalty = 1.0 (반복 억제)
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "스마트팜 기술 나열"}],
    frequency_penalty=1.0  # 같은 단어 반복 줄임
)
```

### 3.5. presence_penalty

**정의**: 새로운 주제 유도 (-2.0 ~ 2.0)

```python
# presence_penalty = 1.5 (다양한 주제)
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "농업 트렌드 10가지"}],
    presence_penalty=1.5  # 다양한 주제 언급
)
```

### 3.6. stop

**정의**: 생성 중단 시퀀스

```python
# 특정 문자열에서 생성 중단
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "스마트팜 장점 나열"}],
    stop=["\n\n", "결론"]  # 이 문자열 나오면 중단
)
```

### 3.7. logit_bias

**정의**: 특정 토큰 확률 조정

```python
# 특정 단어 사용 억제/유도
# (고급 기능, 토큰 ID 필요)
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "농업 설명"}],
    logit_bias={
        # 토큰 ID: 바이어스 값 (-100 ~ 100)
        # 예: "AI" 토큰 사용 억제
        # 실제 사용 시 토큰 ID 확인 필요
    }
)
```

### 3.8. 파라미터 조합 예시

```python
def create_prompt_with_params(task_type):
    """작업 유형별 최적 파라미터"""

    if task_type == "정확한 답변":
        return {
            "temperature": 0,
            "top_p": 0.1,
            "frequency_penalty": 0,
            "presence_penalty": 0
        }

    elif task_type == "창의적 생성":
        return {
            "temperature": 1.2,
            "top_p": 0.9,
            "frequency_penalty": 0.5,
            "presence_penalty": 0.5
        }

    elif task_type == "요약":
        return {
            "temperature": 0.3,
            "max_tokens": 200,
            "frequency_penalty": 0.3,
            "presence_penalty": 0
        }

    else:  # 기본
        return {
            "temperature": 0.7,
            "top_p": 0.9
        }


# 사용 예시
params = create_prompt_with_params("정확한 답변")
response = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "토마토 재배 온도는?"}],
    **params
)
```

---

## 4. 유형별 프롬프트 예시

### 4.1. 질문 응답 (Q&A)

```python
qa_prompt = """
[컨텍스트]
스마트팜은 ICT 기술을 활용하여 농작물의 생육 환경을 자동으로 제어합니다.
센서로 온도, 습도, CO2를 측정하고 최적 환경을 유지합니다.

[질문]
스마트팜의 핵심 기술은?

[답변]
"""
```

### 4.2. 문서 요약

```python
summary_prompt = """
다음 문서를 3줄로 요약하세요:

[문서]
{긴 문서 내용}

[요약 규칙]
- 핵심만 추출
- 숫자 정확히
- 객관적 톤

[요약]
"""
```

### 4.3. 데이터 추출

```python
extraction_prompt = """
다음 텍스트에서 정보를 JSON 형식으로 추출하세요:

[텍스트]
"경기도 A농장에서는 스마트팜을 도입한 후 토마토 생산량이 3톤에서
4.5톤으로 50% 증가했습니다. 담당자는 김철수(010-1234-5678)입니다."

[추출 형식]
{
  "location": "농장 위치",
  "crop": "작물",
  "production_before": "도입 전 생산량",
  "production_after": "도입 후 생산량",
  "increase_rate": "증가율",
  "contact_name": "담당자 이름",
  "contact_phone": "담당자 연락처"
}

[추출 결과]
"""
```

### 4.4. 분류

```python
classification_prompt = """
다음 농업 뉴스를 카테고리로 분류하세요.

[카테고리]
- 기술: 새로운 농업 기술, 장비
- 정책: 정부 지원, 법규
- 시장: 가격, 수요, 수출
- 환경: 기후, 지속가능성

[뉴스]
"정부는 2024년 스마트팜 보급 지원 예산으로 500억원을 편성했다."

[분류]
카테고리:
"""
```

### 4.5. 코드 생성

```python
code_prompt = """
다음 요구사항에 맞는 Python 함수를 작성하세요:

[요구사항]
- 함수명: calculate_growing_days
- 입력: 파종일(문자열, "YYYY-MM-DD"), 수확일(문자열, "YYYY-MM-DD")
- 출력: 재배 일수(정수)
- 에러 처리: 날짜 형식 오류 시 None 반환

[코드]
```python
# 여기에 코드 작성
```

[설명]
- 함수 동작 설명
"""
```

### 4.6. 번역

```python
translation_prompt = """
다음 농업 전문 용어를 영어로 번역하되, 농업 전문가가 사용하는
정확한 용어를 사용하세요:

[한국어]
- 양액:
- 광합성:
- 환경 제어:
- 수경 재배:

[영어]
"""
```

---

## 5. 실전 노하우

### 5.1. 프롬프트 구조화

```python
# 구조화된 프롬프트 템플릿
structured_template = """
[역할]
당신은 {role}입니다.

[맥락]
{context}

[작업]
{task}

[제약 조건]
{constraints}

[출력 형식]
{output_format}

[예시]
{examples}
"""

# 실제 사용
prompt = structured_template.format(
    role="스마트팜 전문가",
    context="초보 농업인을 교육하는 상황",
    task="스마트팜 센서 종류를 설명하세요",
    constraints="- 5가지 이내\n- 각 센서의 기능 포함",
    output_format="불릿 포인트",
    examples="예: 온도 센서 - 온실 내부 온도 측정"
)
```

### 5.2. 반복 개선 (Iteration)

```python
# Version 1: 모호함
v1 = "스마트팜 설명해줘"

# Version 2: 구체화
v2 = "스마트팜의 정의와 주요 기술 3가지를 설명해줘"

# Version 3: 최적화
v3 = """
초보 농업인을 위해 스마트팜을 설명하세요:
1. 정의 (1문장)
2. 주요 기술 3가지 (각 1문장)
3. 도입 효과 (1문장)

형식: 불릿 포인트
"""
```

### 5.3. 에러 처리

```python
def robust_llm_call(prompt, max_retries=3):
    """재시도 로직이 포함된 LLM 호출"""

    for attempt in range(max_retries):
        try:
            response = client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=[{"role": "user", "content": prompt}],
                temperature=0.7,
                max_tokens=500
            )

            return response.choices[0].message.content

        except Exception as e:
            print(f"시도 {attempt + 1} 실패: {e}")

            if attempt == max_retries - 1:
                return None

            # 재시도 전 대기
            import time
            time.sleep(2 ** attempt)  # 지수 백오프

    return None
```

### 5.4. 프롬프트 라이브러리

```python
# 재사용 가능한 프롬프트 라이브러리
class PromptLibrary:
    """프롬프트 템플릿 라이브러리"""

    @staticmethod
    def summarize(text, sentences=3):
        return f"""
        다음 문서를 {sentences}문장으로 요약하세요:

        {text}

        요약:
        """

    @staticmethod
    def classify(text, categories):
        cats = ", ".join(categories)
        return f"""
        다음 텍스트를 카테고리로 분류하세요.

        카테고리: {cats}

        텍스트: {text}

        분류:
        """

    @staticmethod
    def extract_info(text, fields):
        field_desc = "\n".join([f"- {f}" for f in fields])
        return f"""
        다음 텍스트에서 정보를 추출하세요:

        텍스트: {text}

        추출할 정보:
        {field_desc}

        결과:
        """


# 사용
prompts = PromptLibrary()
summary_prompt = prompts.summarize("긴 문서...", sentences=5)
```

### 5.5. 비용 최적화

```python
def estimate_cost(prompt, response, model="gpt-3.5-turbo"):
    """토큰 기반 비용 예측"""

    # 가격 (2024년 기준, 예시)
    prices = {
        "gpt-3.5-turbo": {"input": 0.0015, "output": 0.002},  # per 1K tokens
        "gpt-4": {"input": 0.03, "output": 0.06}
    }

    input_tokens = len(prompt.split()) * 1.3  # 대략 추정
    output_tokens = len(response.split()) * 1.3

    cost = (
        (input_tokens / 1000) * prices[model]["input"] +
        (output_tokens / 1000) * prices[model]["output"]
    )

    return cost


# 비용 확인
prompt = "스마트팜의 장점 10가지를 자세히 설명하세요."
# ... LLM 호출 ...
# cost = estimate_cost(prompt, response)
```

---

**참고 자료**:
- OpenAI Prompt Engineering Guide: https://platform.openai.com/docs/guides/prompt-engineering
- Learn Prompting: https://learnprompting.org/
- Prompt Engineering Guide: https://www.promptingguide.ai/
