# Windows Docker CLI 설치 및 세팅 가이드

## 목차
1. [사전 요구사항](#사전-요구사항)
2. [Docker 설치 방법](#docker-설치-방법)
   - [방법 1: Docker Desktop 설치](#방법-1-docker-desktop-설치-권장)
   - [방법 2: WSL2 내에서 Docker CLI 직접 설치](#방법-2-wsl2-내에서-docker-cli-직접-설치)
3. [설치 확인](#설치-확인)
4. [기본 설정](#기본-설정)
5. [주요 명령어](#주요-명령어)
6. [실용 예제](#실용-예제)
7. [베스트 프랙티스](#베스트-프랙티스)
8. [현재 시스템 상태](#현재-시스템-상태)
9. [트러블슈팅](#트러블슈팅)

---

## 사전 요구사항

### 시스템 요구사항
- **운영체제**: Windows 10 (버전 2004 이상) 또는 Windows 11
- **BIOS 설정**: Virtualization 기능 활성화 필수
- **Windows 기능**: WSL, Virtual Machine Platform
- **메모리**: 최소 4GB RAM (8GB 이상 권장)

### WSL 2 설치 및 설정

Docker는 리눅스 기반 기술이므로, Windows에서 사용하려면 WSL 2를 먼저 활성화해야 합니다.
WSL은 별도의 가상머신 없이도 Windows 내에서 리눅스를 실행할 수 있게 해주며, Docker와의 연동이 원활합니다.

#### 1단계: WSL 기능 활성화
```powershell
# PowerShell 관리자 권한으로 실행

# WSL 활성화
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# Virtual Machine Platform 활성화 (WSL 2 필수)
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

# 또는 간단히 (Windows 10 버전 2004 이상)
wsl --install
```

#### 2단계: Ubuntu 설치 (Docker CLI 설치 시 필수)

##### 방법 1: Microsoft Store (권장)

- Windows 검색 > Microsoft Store
- "Ubuntu" 검색 후 설치
- 설치 후 사용자 이름/비밀번호 설정

##### 방법 2: 명령줄 설치 (더 빠름)

```powershell
# PowerShell에서 실행
wsl --install -d Ubuntu

# 설치 확인
wsl --list --verbose
```

> **참고**: WSL2에서 Docker CLI를 직접 설치하려면 Ubuntu 또는 다른 Linux 배포판이 반드시 필요합니다.

#### 3단계: 재부팅 및 WSL 2 설정
```powershell
# 재부팅 후 실행

# WSL 2를 기본 버전으로 설정
wsl --set-default-version 2

# WSL 버전 확인
wsl --version

# 설치된 배포판 확인
wsl --list --verbose
```

---

## Docker 설치 방법

Windows에서 Docker를 사용하는 방법은 크게 2가지가 있습니다:

### 방법 1: Docker Desktop 설치 (권장)

가장 간단하고 GUI를 제공하는 방법입니다.

#### 다운로드 및 설치

1. https://www.docker.com/products/docker-desktop/ 접속
2. "Download for Windows" 클릭
3. `Docker Desktop Installer.exe` 실행
4. 설치 옵션 선택:
   - ✅ "Use WSL 2 instead of Hyper-V" (권장)
5. 설치 완료 후 재부팅
6. Docker Desktop 실행 및 서비스 약관 동의

---

### 방법 2: WSL2 내에서 Docker CLI 직접 설치

Docker Desktop 없이 순수 CLI만 사용하는 방법입니다. 더 가볍고 리소스 효율적입니다.

#### 전제 조건

- WSL2가 설치되어 있어야 함
- Ubuntu 또는 다른 Linux 배포판이 설치되어 있어야 함

#### 설치 단계

```bash
# WSL Ubuntu 터미널에서 실행

# 1. 기존 패키지 업데이트
sudo apt update
sudo apt upgrade -y

# 2. 필수 패키지 설치
sudo apt install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# 3. Docker 공식 GPG 키 등록
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# 4. Docker 저장소 등록
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 5. Docker 패키지 설치
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 6. Docker 데몬 시작
# 방법 1: service 명령 사용 (권장)
sudo service docker start

# 방법 2: systemd 사용 (Ubuntu 22.04 이상에서 systemd 활성화된 경우)
# sudo systemctl start docker

# 7. Docker 권한 설정 (sudo 없이 사용하려면 필수)
# 주의: root 사용자인 경우 이 단계는 불필요합니다
sudo usermod -aG docker $USER

# 그룹 변경사항을 현재 세션에 즉시 적용
newgrp docker

# 또는 WSL을 재시작하여 적용 (Windows PowerShell에서 실행)
# wsl --shutdown
# wsl -d Ubuntu

# 8. 설치 확인
docker --version
docker compose version
docker run --rm hello-world
```

#### Windows에서 WSL Ubuntu Docker 명령 실행하기

WSL Ubuntu에 Docker를 설치한 후, Windows PowerShell이나 CMD에서 Docker 명령을 실행하려면 다음과 같이 사용합니다:

```powershell
# PowerShell에서 WSL Ubuntu의 Docker 명령 실행
wsl -d Ubuntu docker ps
wsl -d Ubuntu docker images
wsl -d Ubuntu docker run --rm hello-world

# 또는 Ubuntu 터미널로 진입
wsl -d Ubuntu

# Ubuntu 터미널 내에서는 직접 docker 명령 사용
docker ps
docker images
```

#### WSL2에서 Docker 데몬 자동 시작

WSL2는 기본적으로 systemd가 비활성화되어 있어 Docker 데몬을 수동으로 시작해야 합니다.

**방법 1: .bashrc에 추가**

```bash
# ~/.bashrc 파일 끝에 추가
if ! service docker status > /dev/null 2>&1; then
    sudo service docker start > /dev/null 2>&1
fi
```

**방법 2: systemd 활성화 (Ubuntu 22.04 이상)**

```bash
# /etc/wsl.conf 파일 생성/수정
sudo tee /etc/wsl.conf > /dev/null <<EOF
[boot]
systemd=true
EOF

# WSL 재시작 (PowerShell에서 실행)
# wsl --shutdown
# wsl

# systemd 활성화 후
sudo systemctl enable docker
sudo systemctl start docker
```

---

## 설치 확인

### Docker Desktop 설치 확인

```bash
# Docker 버전 확인
docker --version
# 출력 예: Docker version 28.0.1, build 068a01e

# Docker Compose 버전 확인
docker compose version

# 실행 중인 컨테이너 확인
docker ps

# Hello World 테스트
docker run --rm hello-world
```

성공 시 다음과 같은 메시지가 출력됩니다:
```
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

### WSL2 Docker CLI 설치 확인

```bash
# WSL Ubuntu 터미널에서 실행

# Docker 버전 확인
docker --version

# Docker 데몬 상태 확인
sudo service docker status

# 또는 systemd 사용 시
sudo systemctl status docker

# Hello World 테스트
docker run --rm hello-world
```

---

## 기본 설정

### Docker Desktop 설정
Settings > Resources에서 조정:
- **CPUs**: 전체의 50-70%
- **Memory**: 4GB 이상
- **Disk image size**: 필요에 따라 조정

### WSL Integration
Settings > Resources > WSL Integration:
- "Enable integration with my default WSL distro" 활성화

---

## 주요 명령어

### 이미지 관리
```bash
docker pull [이미지명]          # 이미지 다운로드
docker images                   # 이미지 목록
docker rmi [이미지ID]           # 이미지 삭제
docker image prune -a           # 미사용 이미지 정리
```

### 컨테이너 관리
```bash
docker run [이미지명]           # 컨테이너 실행
docker ps                       # 실행중인 컨테이너
docker ps -a                    # 모든 컨테이너
docker stop [컨테이너ID]        # 컨테이너 중지
docker rm [컨테이너ID]          # 컨테이너 삭제
docker logs [컨테이너ID]        # 로그 확인
docker exec -it [ID] /bin/bash  # 컨테이너 접속
```

### 시스템 관리
```bash
docker system df                # 디스크 사용량
docker system prune -a          # 전체 정리
```

### Docker Compose
```bash
docker compose up -d            # 백그라운드로 서비스 시작
docker compose down             # 서비스 중지 및 제거
docker compose logs -f          # 실시간 로그 확인
docker compose ps               # 서비스 상태
```

---

## 실용 예제

### 1. Nginx 웹서버 실행
```bash
# Nginx 실행 (포트 8080으로 접근)
docker run -d -p 8080:80 --name my-nginx nginx

# 브라우저에서 http://localhost:8080 접속하여 확인
```

### 2. MySQL 데이터베이스 실행
```bash
# MySQL 실행
docker run -d \
  --name mysql-db \
  -e MYSQL_ROOT_PASSWORD=mypassword \
  -e MYSQL_DATABASE=testdb \
  -p 3306:3306 \
  mysql:8.0

# 데이터베이스 접속
docker exec -it mysql-db mysql -u root -p
```

### 3. Node.js 개발 환경
```bash
# Node.js 컨테이너에서 명령 실행
docker run -it --rm -v ${PWD}:/app -w /app node:20 npm init -y
```

### 4. 볼륨을 사용한 데이터 영속화
```bash
# 볼륨 생성
docker volume create my-data

# 볼륨을 마운트하여 컨테이너 실행
docker run -d -v my-data:/data --name data-container alpine

# 볼륨 목록 확인
docker volume ls
```

---

## 베스트 프랙티스

### 1. 리소스 관리
```bash
# 정기적으로 미사용 리소스 정리
docker system prune -a --volumes

# 특정 컨테이너 리소스 제한
docker run -d --memory="512m" --cpus="1.0" nginx
```

### 2. 보안
```bash
# 최신 이미지 사용
docker pull nginx:latest

# 이미지 취약점 스캔
docker scout quickview nginx:latest

# 읽기 전용 파일시스템으로 실행
docker run --read-only nginx
```

### 3. 로깅 및 모니터링
```bash
# 로그 크기 제한
docker run -d --log-opt max-size=10m --log-opt max-file=3 nginx

# 컨테이너 리소스 사용량 모니터링
docker stats

# 특정 컨테이너만 모니터링
docker stats [컨테이너ID]
```

### 4. 네트워크 관리
```bash
# 커스텀 네트워크 생성
docker network create my-network

# 네트워크에 연결하여 컨테이너 실행
docker run -d --network my-network --name web nginx
docker run -d --network my-network --name db mysql

# 네트워크 목록 확인
docker network ls
```

### 5. 개발 워크플로우
```bash
# 개발 중인 코드를 마운트하여 실행
docker run -d \
  -p 3000:3000 \
  -v ${PWD}:/app \
  -w /app \
  --name dev-container \
  node:20 \
  npm run dev

# 컨테이너 내부에서 작업
docker exec -it dev-container bash
```

---

## 현재 시스템 상태

### WSL2 Ubuntu에 설치된 Docker CLI

- **WSL Version**: 2.4.12.0
- **Ubuntu Version**: 24.04 LTS (Noble Numbat)
- **Docker Version**: 28.5.1, build e180ab8
- **Docker Compose Version**: v2.40.1

### 설치된 Docker 패키지

- **containerd.io**: 1.7.28
- **docker-ce**: 28.5.1 (Docker Engine)
- **docker-ce-cli**: 28.5.1 (Docker CLI)
- **docker-buildx-plugin**: 0.29.1 (Docker Buildx)
- **docker-compose-plugin**: 2.40.1 (Docker Compose)

### Docker Desktop 시작 방법
Docker CLI가 설치되어 있지만, Docker Desktop이 실행되지 않은 경우:

1. **시작 메뉴에서 실행**
   - 시작 메뉴에서 "Docker Desktop" 검색 후 실행

2. **명령줄에서 실행**
   ```powershell
   # Docker Desktop 실행
   & "C:\Program Files\Docker\Docker\Docker Desktop.exe"
   ```

3. **상태 확인**
   - 작업 표시줄 우측 하단의 Docker 고래 아이콘 확인
   - 아이콘이 초록색이면 정상 실행 중

---

## 트러블슈팅

### 1. apt update 시 "Hash Sum mismatch" 오류

**증상**:
```text
E: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/noble-updates/...
Hash Sum mismatch
E: Some index files failed to download. They have been ignored, or old ones used instead.
```

**원인**: Ubuntu 저장소 미러 서버의 일시적인 동기화 문제

**해결방법**:
```bash
# 방법 1: apt 캐시 정리 후 재시도
sudo apt clean
sudo apt update

# 방법 2: 오류를 무시하고 계속 진행
# "old ones used instead" 메시지가 표시되면 기존 패키지 목록으로 설치 가능
# Docker 저장소는 정상적으로 추가되었는지 확인:
sudo apt update 2>&1 | grep docker.com

# 방법 3: 다른 미러 서버 사용
# /etc/apt/sources.list 파일에서 archive.ubuntu.com을
# kr.archive.ubuntu.com 또는 mirror.kakao.com으로 변경
```

> **참고**: 이 오류는 Docker 설치에는 영향을 주지 않습니다. Docker 공식 저장소가 정상적으로 추가되었다면 설치를 계속 진행할 수 있습니다.

---

### 2. "cannot find the file specified" 오류

**증상**:
```text
error during connect: open //./pipe/dockerDesktopLinuxEngine: The system cannot find the file specified.
```

**원인**: Docker Desktop이 실행되지 않음

**해결방법**:
1. Docker Desktop 실행
2. Docker Engine이 완전히 시작될 때까지 대기 (1-2분 소요)
3. 다시 `docker ps` 명령어 실행

---

### 2. WSL 2 커널 업데이트 요구

**증상**: "WSL 2 installation is incomplete" 또는 "WSL 2 kernel update required"

**해결방법**:
```powershell
# WSL 업데이트
wsl --update

# WSL 버전 확인
wsl --version

# 필요 시 수동 다운로드
# https://aka.ms/wsl2kernel
```

---

### 3. Virtualization 비활성화 오류

**증상**: "Hardware assisted virtualization and data execution protection must be enabled in the BIOS"

**해결방법**:
1. 컴퓨터 재부팅
2. BIOS/UEFI 진입 (보통 F2, F10, Del 키)
3. Virtualization Technology (VT-x/AMD-V) 활성화
4. 저장 후 재부팅

---

### 4. docker-desktop WSL 배포판에서 Docker 명령 불가

**증상**:
```text
It looks like you have tried to invoke the docker CLI from the docker-desktop WSL2 distribution.
This is not supported.
```

**원인**: docker-desktop WSL 배포판은 Docker Desktop 전용이며 직접 접근 불가

**해결방법**:
- **방법 1**: Windows PowerShell/CMD에서 docker 명령어 실행
- **방법 2**: Ubuntu 등 다른 WSL 배포판 설치 후 Docker Desktop WSL Integration 활성화
  1. Docker Desktop > Settings > Resources > WSL Integration
  2. Ubuntu 또는 원하는 배포판 활성화

---

### 5. WSL2에서 Docker 데몬이 시작되지 않음

**증상**: `Cannot connect to the Docker daemon`

**해결방법**:
```bash
# Docker 데몬 수동 시작
sudo dockerd &

# 또는 systemd 활성화 후
sudo systemctl start docker
sudo systemctl enable docker

# 데몬 상태 확인
ps aux | grep dockerd
```

---

### 6. 포트 충돌 오류

**증상**: "port is already allocated"

**해결방법**:
```bash
# Windows에서 포트 사용 확인
netstat -ano | findstr :[포트번호]

# 다른 포트 사용
docker run -p [다른포트]:[컨테이너포트] [이미지명]
```

---

### 7. 디스크 공간 부족

**증상**: "no space left on device"

**해결방법**:
```bash
# 디스크 사용량 확인
docker system df

# 미사용 리소스 정리
docker system prune -a --volumes

# 개별 정리
docker container prune  # 중지된 컨테이너
docker image prune -a   # 미사용 이미지
docker volume prune     # 미사용 볼륨
```

---

### 8. sudo 없이 Docker 사용 (WSL2)

**증상**:
```text
permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock:
Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.51/containers/json": dial unix /var/run/docker.sock: connect: permission denied
```

**원인**: 현재 사용자가 docker 그룹에 속하지 않음

**해결방법**:

#### 방법 1: sudo 사용 (즉시 적용)
```bash
# Docker 명령어에 sudo 붙여서 실행
sudo docker ps
sudo docker images
sudo docker run hello-world
```

#### 방법 2: docker 그룹에 사용자 추가 (권장)
```bash
# 1. 현재 사용자를 docker 그룹에 추가
sudo usermod -aG docker $USER

# 2. 그룹 변경사항 적용 (다음 중 하나 선택)

# 옵션 A: 새 그룹으로 전환 (현재 세션에서 즉시 적용)
newgrp docker

# 옵션 B: WSL 재시작 (가장 확실한 방법)
# Windows PowerShell에서 실행:
# wsl --shutdown
# wsl -d Ubuntu

# 옵션 C: 로그아웃 후 재로그인

# 3. 확인
docker ps  # sudo 없이 실행
```

#### 방법 3: Windows에서 WSL 명령어로 실행
```powershell
# Windows PowerShell에서 sudo와 함께 실행
wsl -d Ubuntu sudo docker ps
wsl -d Ubuntu sudo docker images
```

> **참고**: `usermod` 명령으로 그룹을 추가한 후에는 반드시 새 세션을 시작해야 변경사항이 적용됩니다. `newgrp docker` 또는 WSL 재시작을 권장합니다.

---

## 요약 및 권장사항

### Docker Desktop vs WSL2 직접 설치 비교

| 항목 | Docker Desktop | WSL2 직접 설치 |
|-----|---------------|---------------|
| **설치 난이도** | 쉬움 (GUI 설치) | 중간 (CLI 명령어 필요) |
| **GUI 제공** | ✅ 제공 | ❌ CLI만 제공 |
| **리소스 사용** | 높음 | 낮음 |
| **Windows 통합** | ✅ 우수 | ⚠️ 제한적 |
| **자동 업데이트** | ✅ 지원 | ❌ 수동 관리 |
| **Docker Compose** | ✅ 포함 | ✅ 별도 설치 가능 |
| **권장 대상** | 일반 사용자, 개발자 | 경량화 선호, CLI 익숙한 사용자 |

### 권장사항

- **초보자/일반 개발자**: Docker Desktop 설치 권장
- **리소스 절약 필요**: WSL2 직접 설치 고려
- **프로덕션 환경**: Linux 서버에서 직접 설치
- **정기적인 정리**: `docker system prune` 주기적 실행

---

## 참고 자료

### 공식 문서
- [Docker 공식 문서](https://docs.docker.com/)
- [Docker Desktop for Windows](https://docs.docker.com/desktop/install/windows-install/)
- [WSL 2 문서](https://docs.microsoft.com/en-us/windows/wsl/)
- [Docker Hub](https://hub.docker.com/)

### 추가 학습 자료
- [Docker Compose 문서](https://docs.docker.com/compose/)
- [Dockerfile 작성 가이드](https://docs.docker.com/engine/reference/builder/)
- [Docker 보안 가이드](https://docs.docker.com/engine/security/)

### 유용한 명령어 치트시트
```bash
# 이미지
docker pull [이미지]              # 다운로드
docker images                    # 목록
docker rmi [이미지]               # 삭제

# 컨테이너
docker run [옵션] [이미지]        # 실행
docker ps                        # 실행중 목록
docker stop [컨테이너]            # 중지
docker rm [컨테이너]              # 삭제

# 시스템
docker system df                 # 디스크 사용량
docker system prune -a           # 정리
docker logs [컨테이너]            # 로그
docker stats                     # 리소스 모니터링
```

---

**문서 작성일**: 2025-10-19
**Docker 버전**: 28.5.1
**시스템**: Windows 10/11 (WSL 2)
**테스트 완료**:

- ✅ Docker Desktop 정상 작동 확인
- ✅ WSL2 Ubuntu Docker CLI 직접 설치 및 작동 확인
