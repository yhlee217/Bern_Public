# 3ë‹¨ê³„: API ì„œë²„ ê°œë°œ - í•™ìŠµ ë‚´ìš©

> **í•™ìŠµ ê¸°ê°„**: 2025ë…„ 10ì›”
> **ì†Œìš” ì‹œê°„**: 12ì‹œê°„
> **í•™ìŠµ ëª©í‘œ**: SQLAlchemyì™€ FastAPIë¥¼ í™œìš©í•œ RESTful API ì„œë²„ ê°œë°œ

---

## ğŸ“š í•™ìŠµ ì£¼ì œ

1. SQLAlchemy (ORM)
2. FastAPI (REST API)
3. ë””ìì¸ íŒ¨í„´ (3ê³„ì¸µ ì•„í‚¤í…ì²˜)
4. Logging (ë¡œê¹… ì‹œìŠ¤í…œ)

---

## 1. SQLAlchemy (ORM)

### í•™ìŠµ ë‚´ìš©

#### 1.1 ORMì´ë€?

**ORM (Object-Relational Mapping)**:
- ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§¤í•‘
- SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³  Python ì½”ë“œë¡œ DB ì¡°ì‘

**ì¥ì **:
| ì¥ì  | ì„¤ëª… |
|-----|------|
| ìƒì‚°ì„± | SQL ëª°ë¼ë„ DB ì¡°ì‘ ê°€ëŠ¥ |
| ìœ ì§€ë³´ìˆ˜ì„± | ê°ì²´ ì§€í–¥ì  ì½”ë“œ |
| DB ë…ë¦½ì„± | MySQL â†” PostgreSQL ì‰½ê²Œ ë³€ê²½ |
| íƒ€ì… ì•ˆì „ì„± | IDE ìë™ì™„ì„± ì§€ì› |

**ë‹¨ì **:
| ë‹¨ì  | ì„¤ëª… |
|-----|------|
| ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ | ë³µì¡í•œ ì¿¼ë¦¬ëŠ” Raw SQLë³´ë‹¤ ëŠë¦¼ |
| í•™ìŠµ ê³¡ì„  | ORM ìì²´ë¥¼ í•™ìŠµí•´ì•¼ í•¨ |

#### 1.2 ëª¨ë¸ ì •ì˜

**ê¸°ë³¸ êµ¬ì¡°**:
```python
from sqlalchemy import Column, Integer, String
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class User(Base):
    __tablename__ = 'users'

    id = Column(Integer, primary_key=True)
    name = Column(String(50))
    email = Column(String(100), unique=True)
```

**ì»¬ëŸ¼ íƒ€ì…**:
| SQLAlchemy | Python | SQL |
|-----------|--------|-----|
| `Integer` | `int` | INTEGER |
| `String(n)` | `str` | VARCHAR(n) |
| `Text` | `str` | TEXT |
| `Boolean` | `bool` | BOOLEAN |
| `DateTime` | `datetime` | DATETIME |
| `JSON` | `dict` | JSON |

**ì œì•½ì¡°ê±´**:
- `primary_key=True`: ê¸°ë³¸ í‚¤
- `unique=True`: ê³ ìœ  ê°’
- `nullable=False`: NULL ë¶ˆê°€
- `default=ê°’`: ê¸°ë³¸ê°’

#### 1.3 CRUD ì‘ì—…

**CREATE (ìƒì„±)**:
```python
user = User(name='í™ê¸¸ë™', email='hong@test.com')
session.add(user)
session.commit()
```

**READ (ì¡°íšŒ)**:
```python
# ì „ì²´ ì¡°íšŒ
users = session.query(User).all()

# ì¡°ê±´ ì¡°íšŒ
user = session.query(User).filter(User.id == 1).first()

# ì—¬ëŸ¬ ì¡°ê±´
users = session.query(User).filter(
    User.age >= 20,
    User.is_active == True
).all()
```

**UPDATE (ìˆ˜ì •)**:
```python
user = session.query(User).filter(User.id == 1).first()
user.email = 'new@test.com'
session.commit()
```

**DELETE (ì‚­ì œ)**:
```python
user = session.query(User).filter(User.id == 1).first()
session.delete(user)
session.commit()
```

#### 1.4 ê´€ê³„ ì„¤ì •

**1:N (One-to-Many)**:
```python
class Author(Base):
    __tablename__ = 'authors'
    id = Column(Integer, primary_key=True)
    name = Column(String(50))

    # ê´€ê³„ ì •ì˜
    posts = relationship('Post', back_populates='author')

class Post(Base):
    __tablename__ = 'posts'
    id = Column(Integer, primary_key=True)
    title = Column(String(200))
    author_id = Column(Integer, ForeignKey('authors.id'))

    # ê´€ê³„ ì •ì˜
    author = relationship('Author', back_populates='posts')
```

**N:M (Many-to-Many)**:
```python
# ì—°ê²° í…Œì´ë¸”
student_course = Table('student_course', Base.metadata,
    Column('student_id', Integer, ForeignKey('students.id')),
    Column('course_id', Integer, ForeignKey('courses.id'))
)

class Student(Base):
    __tablename__ = 'students'
    id = Column(Integer, primary_key=True)
    courses = relationship('Course', secondary=student_course)
```

### í•™ìŠµ í¬ì¸íŠ¸
- âœ… ORMì˜ ê°œë…ê³¼ í•„ìš”ì„±
- âœ… ëª¨ë¸ ì •ì˜ ë° CRUD ì‘ì—…
- âœ… 1:N, N:M ê´€ê³„ ì„¤ì •

---

## 2. FastAPI (REST API)

### í•™ìŠµ ë‚´ìš©

#### 2.1 HTTP ë©”ì„œë“œ

| ë©”ì„œë“œ | ì˜ë¯¸ | CRUD | ìš©ë„ |
|-------|------|------|------|
| **GET** | ì¡°íšŒ | Read | ë¦¬ì†ŒìŠ¤ ì¡°íšŒ |
| **POST** | ìƒì„± | Create | ë¦¬ì†ŒìŠ¤ ìƒì„± |
| **PUT** | ì „ì²´ ìˆ˜ì • | Update | ë¦¬ì†ŒìŠ¤ ì „ì²´ êµì²´ |
| **PATCH** | ë¶€ë¶„ ìˆ˜ì • | Update | ë¦¬ì†ŒìŠ¤ ì¼ë¶€ ìˆ˜ì • |
| **DELETE** | ì‚­ì œ | Delete | ë¦¬ì†ŒìŠ¤ ì‚­ì œ |

#### 2.2 RESTful API ì„¤ê³„

**URL ê·œì¹™**:
```
GET    /users        # ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
GET    /users/1      # IDê°€ 1ì¸ ì‚¬ìš©ì ì¡°íšŒ
POST   /users        # ìƒˆ ì‚¬ìš©ì ìƒì„±
PUT    /users/1      # IDê°€ 1ì¸ ì‚¬ìš©ì ì „ì²´ ìˆ˜ì •
PATCH  /users/1      # IDê°€ 1ì¸ ì‚¬ìš©ì ì¼ë¶€ ìˆ˜ì •
DELETE /users/1      # IDê°€ 1ì¸ ì‚¬ìš©ì ì‚­ì œ
```

#### 2.3 FastAPI ê¸°ë³¸ ì‚¬ìš©

**ì„¤ì¹˜**:
```bash
pip install fastapi uvicorn
```

**ê¸°ë³¸ ì•±**:
```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def root():
    return {"message": "Hello World"}

@app.get("/users/{user_id}")
def get_user(user_id: int):
    return {"user_id": user_id}
```

**ì‹¤í–‰**:
```bash
uvicorn main:app --reload
```

#### 2.4 Request/Response ëª¨ë¸

**Pydantic ëª¨ë¸**:
```python
from pydantic import BaseModel

class UserCreate(BaseModel):
    name: str
    email: str

class UserResponse(BaseModel):
    id: int
    name: str
    email: str

@app.post("/users", response_model=UserResponse)
def create_user(user: UserCreate):
    return {"id": 1, "name": user.name, "email": user.email}
```

#### 2.5 HTTP ë°ì´í„° ì „ì†¡

| ë°©ë²• | ìœ„ì¹˜ | Content-Type | ìš©ë„ |
|-----|------|-------------|------|
| **Body** | Request Body | `application/json` | JSON ë°ì´í„° |
| **Query** | URL Parameter | - | í•„í„°, í˜ì´ì§€ë„¤ì´ì…˜ |
| **Path** | URL Path | - | ë¦¬ì†ŒìŠ¤ ID |
| **Form** | Request Body | `application/x-www-form-urlencoded` | HTML í¼ |
| **File** | Request Body | `multipart/form-data` | íŒŒì¼ ì—…ë¡œë“œ |

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from fastapi import Query, Body, File

@app.get("/items")
def get_items(skip: int = Query(0), limit: int = Query(10)):
    return {"skip": skip, "limit": limit}

@app.post("/upload")
async def upload_file(file: UploadFile = File(...)):
    return {"filename": file.filename}
```

#### 2.6 ìƒíƒœ ì½”ë“œ

| ì½”ë“œ | ì˜ë¯¸ | ì‚¬ìš© ì˜ˆì‹œ |
|-----|------|----------|
| **200** | OK | ì„±ê³µì ì¸ GET, PUT |
| **201** | Created | ë¦¬ì†ŒìŠ¤ ìƒì„± (POST) |
| **204** | No Content | ì‚­ì œ ì„±ê³µ (DELETE) |
| **400** | Bad Request | ì˜ëª»ëœ ìš”ì²­ |
| **404** | Not Found | ë¦¬ì†ŒìŠ¤ ì—†ìŒ |
| **500** | Server Error | ì„œë²„ ì˜¤ë¥˜ |

### í•™ìŠµ í¬ì¸íŠ¸
- âœ… RESTful API ì„¤ê³„ ì›ì¹™
- âœ… HTTP ë©”ì„œë“œë³„ ìš©ë„
- âœ… Request/Response ëª¨ë¸ ì •ì˜

---

## 3. ë””ìì¸ íŒ¨í„´ (3ê³„ì¸µ ì•„í‚¤í…ì²˜)

### í•™ìŠµ ë‚´ìš©

#### 3.1 3ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Router (Presentation Layer)      â”‚  â† HTTP ìš”ì²­/ì‘ë‹µ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Service (Business Logic Layer)   â”‚  â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Repository (Data Access Layer)   â”‚  â† DB ì ‘ê·¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 ê° ê³„ì¸µì˜ ì—­í• 

| ê³„ì¸µ | ì—­í•  | ì±…ì„ |
|-----|------|------|
| **Router** | HTTP ì²˜ë¦¬ | ìš”ì²­ íŒŒì‹±, ì‘ë‹µ í˜•ì‹í™” |
| **Service** | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | ì—…ë¬´ ê·œì¹™, ë°ì´í„° ê°€ê³µ |
| **Repository** | ë°ì´í„° ì ‘ê·¼ | CRUD, ì¿¼ë¦¬ ì‹¤í–‰ |

#### 3.3 ê³„ì¸µë³„ êµ¬í˜„

**Repository (ë°ì´í„° ì ‘ê·¼)**:
```python
class UserRepository:
    def __init__(self, db: Session):
        self.db = db

    def find_by_id(self, user_id: int):
        return self.db.query(User).filter(User.id == user_id).first()

    def create(self, user_data: dict):
        user = User(**user_data)
        self.db.add(user)
        self.db.commit()
        return user
```

**Service (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)**:
```python
class UserService:
    def __init__(self, repository: UserRepository):
        self.repository = repository

    def create_user(self, user: UserCreate):
        # ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
        if self.repository.find_by_email(user.email):
            raise HTTPException(400, "Email exists")

        # ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
        hashed_password = hash_password(user.password)

        # Repository í˜¸ì¶œ
        return self.repository.create({
            **user.dict(),
            "password": hashed_password
        })
```

**Router (HTTP ì²˜ë¦¬)**:
```python
@app.post("/users", status_code=201)
def create_user(
    user: UserCreate,
    service: UserService = Depends()
):
    """ì‚¬ìš©ì ìƒì„± - RouterëŠ” HTTPë§Œ ì²˜ë¦¬"""
    return service.create_user(user)
```

#### 3.4 ì¥ë‹¨ì 

**ì¥ì **:
- âœ… ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (Separation of Concerns)
- âœ… í…ŒìŠ¤íŠ¸ ìš©ì´ì„± (Mock ì‚¬ìš©)
- âœ… ì½”ë“œ ì¬ì‚¬ìš©ì„±
- âœ… ìœ ì§€ë³´ìˆ˜ í¸ì˜ì„±

**ë‹¨ì **:
- âŒ ì½”ë“œëŸ‰ ì¦ê°€ (ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸)
- âŒ ì‘ì€ í”„ë¡œì íŠ¸ì—ëŠ” ê³¼í•  ìˆ˜ ìˆìŒ

**ì–¸ì œ ì‚¬ìš©?**:
- API 10ê°œ ì´ìƒ
- ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- íŒ€ í˜‘ì—… í”„ë¡œì íŠ¸

### í•™ìŠµ í¬ì¸íŠ¸
- âœ… 3ê³„ì¸µ ì•„í‚¤í…ì²˜ì˜ êµ¬ì¡°
- âœ… ê° ê³„ì¸µì˜ ì±…ì„ ë¶„ë¦¬
- âœ… ì˜ì¡´ì„± ì£¼ì… (Dependency Injection)

---

## 4. Logging (ë¡œê¹… ì‹œìŠ¤í…œ)

### í•™ìŠµ ë‚´ìš©

#### 4.1 ë¡œê·¸ì˜ í•„ìš”ì„±

| ëª©ì  | ì„¤ëª… |
|-----|------|
| **ë””ë²„ê¹…** | ë²„ê·¸ ì›ì¸ íŒŒì•… |
| **ëª¨ë‹ˆí„°ë§** | ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ì¶”ì  |
| **ì„±ëŠ¥ ë¶„ì„** | ëŠë¦° API ì°¾ê¸° |
| **ë³´ì•ˆ** | ë¹„ì •ìƒ ì ‘ê·¼ ê°ì§€ |
| **ê°ì‚¬** | ëˆ„ê°€ ì–¸ì œ ë¬´ì—‡ì„ í–ˆëŠ”ì§€ ê¸°ë¡ |

#### 4.2 ë¡œê·¸ ë ˆë²¨

| ë ˆë²¨ | ìš©ë„ | ì˜ˆì‹œ |
|-----|------|------|
| **DEBUG** | ìƒì„¸í•œ ë””ë²„ê¹… ì •ë³´ | ë³€ìˆ˜ ê°’, í•¨ìˆ˜ í˜¸ì¶œ |
| **INFO** | ì¼ë°˜ ì •ë³´ | ì„œë²„ ì‹œì‘, ìš”ì²­ ì²˜ë¦¬ |
| **WARNING** | ê²½ê³  ë©”ì‹œì§€ | ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ |
| **ERROR** | ì—ëŸ¬ ë°œìƒ | ì˜ˆì™¸ ì²˜ë¦¬, ì‹¤íŒ¨í•œ ì‘ì—… |
| **CRITICAL** | ì‹¬ê°í•œ ì˜¤ë¥˜ | ì„œë²„ ë‹¤ìš´ |

#### 4.3 ë¡œê¹… ì„¤ì •

**ê¸°ë³¸ ì„¤ì •**:
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S'
)

logger = logging.getLogger(__name__)
logger.info("Application started")
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
2025-10-26 10:30:15 - __main__ - INFO - Application started
```

#### 4.4 íŒŒì¼ ë¡œê¹…

**ë¡œí…Œì´ì…˜ ì„¤ì •**:
```python
from logging.handlers import RotatingFileHandler

handler = RotatingFileHandler(
    'app.log',
    maxBytes=10*1024*1024,  # 10MB
    backupCount=5  # ìµœëŒ€ 5ê°œ íŒŒì¼ ë³´ê´€
)
```

**ì‹œê°„ ê¸°ë°˜ ë¡œí…Œì´ì…˜**:
```python
from logging.handlers import TimedRotatingFileHandler

handler = TimedRotatingFileHandler(
    'app.log',
    when='midnight',  # ë§¤ì¼ ìì •
    backupCount=30  # 30ì¼ ë³´ê´€
)
```

#### 4.5 ìš”ì²­/ì‘ë‹µ ë¡œê¹…

**ë¯¸ë“¤ì›¨ì–´**:
```python
@app.middleware("http")
async def log_requests(request: Request, call_next):
    start_time = time.time()

    logger.info(f"Request: {request.method} {request.url.path}")

    response = await call_next(request)

    process_time = time.time() - start_time
    logger.info(
        f"Response: {request.method} {request.url.path} "
        f"- Status: {response.status_code} "
        f"- Time: {process_time:.3f}s"
    )

    return response
```

#### 4.6 í™˜ê²½ë³„ ë¡œê·¸ ë ˆë²¨

| í™˜ê²½ | ë ˆë²¨ | ì´ìœ  |
|-----|------|------|
| **ê°œë°œ** | DEBUG | ëª¨ë“  ì •ë³´ í•„ìš” |
| **ìŠ¤í…Œì´ì§•** | INFO | ì¼ë°˜ ì •ë³´ë§Œ |
| **ìš´ì˜** | WARNING | ê²½ê³  ì´ìƒë§Œ |

### í•™ìŠµ í¬ì¸íŠ¸
- âœ… ë¡œê·¸ ë ˆë²¨ ì´í•´
- âœ… íŒŒì¼ ë¡œí…Œì´ì…˜ ì„¤ì •
- âœ… ìš”ì²­/ì‘ë‹µ ë¡œê¹… ë¯¸ë“¤ì›¨ì–´

---

## ğŸ’¡ í†µí•© ì˜ˆì‹œ: ì „ì²´ êµ¬ì¡°

### í”„ë¡œì íŠ¸ êµ¬ì¡°
```
project/
â”œâ”€â”€ main.py              # FastAPI ì•±
â”œâ”€â”€ models/              # SQLAlchemy ëª¨ë¸
â”‚   â””â”€â”€ user_model.py
â”œâ”€â”€ schemas/             # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ user_schema.py
â”œâ”€â”€ routers/             # Router ê³„ì¸µ
â”‚   â””â”€â”€ user_router.py
â”œâ”€â”€ services/            # Service ê³„ì¸µ
â”‚   â””â”€â”€ user_service.py
â””â”€â”€ repositories/        # Repository ê³„ì¸µ
    â””â”€â”€ user_repository.py
```

### ë°ì´í„° íë¦„
```
1. Client â†’ POST /users (HTTP ìš”ì²­)
   â†“
2. Router: create_user() í˜¸ì¶œ
   â†“
3. Service.create_user()
   - ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
   - ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
   - Repository.create() í˜¸ì¶œ
   â†“
4. Repository.create()
   - DB INSERT
   â†“
5. Response: 201 Created + User ì •ë³´
```

---

## ğŸ“– ì°¸ê³  ìë£Œ

### ë‚´ë¶€ ë¬¸ì„œ (R&D í´ë”)
- 1.3.01 ~ 1.3.06: SQLAlchemy, FastAPI ìƒì„¸ ê°€ì´ë“œ

### ì™¸ë¶€ ë¬¸ì„œ
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Python Logging](https://docs.python.org/3/library/logging.html)

---

**ì‘ì„±ì¼**: 2025ë…„ 10ì›” 26ì¼
**í•™ìŠµ ì™„ë£Œ**: âœ…
